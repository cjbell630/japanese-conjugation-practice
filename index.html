<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="manifest" href="/app/manifest.webmanifest">
    <script src="app/service-worker.js"></script>
    <script src="res/json_contents.js"></script>
    <script src="script/util.js"></script>
    <script src="script/conjugation-parser.js"></script>
    <script src="script/conjugator.js"></script>
    <script src="res/words.js"></script>
</head>
<body>
<label for="wordDropdown"></label><select id="wordDropdown"></select>
<label for="formDropdown"></label><select id="formDropdown"></select>
<button id="goButton" onclick="goButtonClick()">Go</button>
<p id="resultsP">No results yet</p>
<script>
    let wordDropdown = document.getElementById("wordDropdown");
    let formDropdown = document.getElementById("formDropdown");
    let resultsP = document.getElementById("resultsP");

    function loadWords() {
        Object.keys(VERBS["Genki 1"]["Lesson 3"]).forEach(verb => {
            let option = document.createElement("option");
            option.textContent = verb;
            option.value = verb;
            wordDropdown.appendChild(option);
        });
    }

    function loadForms() {
        Object.keys(JSON_CONTENTS["verbs"]["base"]["regular"]).forEach(formGroupName => {
            let forms = JSON_CONTENTS["verbs"]["base"]["regular"][formGroupName].length === 1 ?
                [formGroupName] : [formGroupName, formGroupName + "NEG"];

            forms.forEach(formID => {
                let option = document.createElement("option");
                option.textContent = formID; //TODO: replace with user friendly name
                option.value = formID;
                formDropdown.appendChild(option);
            });
        });
    }

    function goButtonClick() {
        let raw = conjugateWord(wordDropdown.value, VERBS["Genki 1"]["Lesson 3"][wordDropdown.value]);
        console.log("button raw result: ");
        console.log(raw);
        console.log("raw json: ");
        console.log(JSON_CONTENTS);
        resultsP.innerText =
            raw[formDropdown.value.replace("NEG", "")][formDropdown.value.endsWith("NEG") ? 1 : 0];
    }

    function handleServiceWorker() {
        //https://deanhume.com/displaying-a-new-version-available-progressive-web-app/
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register("app/service-worker.js").then(function (registration) {
                // Registration was successful
                console.log('ServiceWorker registration successful with scope: ', registration.scope);
            }).catch(function (err) {
                // registration failed :(
                console.log('ServiceWorker registration failed: ', err);
            });
        }
    }

    loadForms();
    loadWords();
    handleServiceWorker();
</script>
</body>
</html>